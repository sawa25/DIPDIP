<!DOCTYPE html>
<html>
<head>
 <script>
document.addEventListener("DOMContentLoaded", function() {
    document.getElementById("submitForm").elements.namedItem("submitButton").disabled = true;
    var socket = new WebSocket("ws://localhost:5000/ws/");
    socket.onopen = function(e) {
        console.log("[open] Соединение установлено");
    };

    socket.onmessage = function(event) {
        var msg = event.data;
        if (msg === "finish") {
            document.getElementById("submitForm").elements.namedItem("submitButton").disabled = false;
        } else {
            document.getElementById("messages").innerHTML += `<p>${msg}</p>`;
        }    
    };

    socket.onerror = function(error) {
        alert(`[error] ${error.message}`);
    };
    socket.onclose = function(e) {
        console.log("[close] Соединение закрыто");
        document.getElementById("messages").innerHTML = "<p>Система загружена и готова к работе!</p>";
    };    
});

window.addEventListener("beforeunload", function(e) {
    socket.close();
});
</script>
<style>
    #messages p {
        background-color: lightgray;
        padding: 10px;
        margin-bottom: 5px;
    }
    </style>
    
    <title>Получить предложение по топ 3 товарам для выбранного клиента</title>
</head>
<body>
  <div id="messages"></div>
    <h1>Получить предложение по топ 3 товарам для выбранного клиента</h1>
    <form id="submitForm" method="post" action="/submit/" enabled=false disabled = "true">
        <label for="input_text">Введите идентификатор клиента:</label>
        <input type="text" id="input_text" name="input_text">
        <input type="submit" id="submitButton" value="Submit">
    </form>

    {% if result %}
    <h2>Ответ рекомендательной системы</h2>
    <p>Для клиента: {{ input_text }}</p>
    <p>Топ 3 товара: {{ result }}</p>
    {% endif %}
</body>
</html>
